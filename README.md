# EatDayBookBot
Это учебный репозиторий с ботом на Python.
[Ссылка на бота](https://vk.com/club197499067 "https://vk.com/club197499067")

### Цель бота
Бот помогает вести дневник калорий посредством общения с ним в соцсети Вконтакте. 

### Возможности бота
* Учет часового пояса пользователя.
* Добавление калорий к общему списку за день.
* Исправить неправильно введенные значения.
* Узнать сумму введенных калорий за любой день пользования ботом.
* Настройка напоминаний от бота о необходимости ввести калории.
* Полное удаление информации о пользователе по команде.
* Информирование пользователя о неправильно введенной команде и типе ошибки.  

### Возможные команды
* start - приветственное информационное сообщение от бота;
* add 200 300 - добавление 500 калорий к общему списку калорий за день;
* sub 100 - вычитание 100 калорий из общего списка за день;
* give today - сообщение от бота о сумме записанных калорий за текущий день (так же give 16.04, give all);
* set time 18:48 - информирование бота о своем часовом поясе;
* set eating 18:50 08:00 15:45 - информирование бота о времени для напоминания: таким образом бот будет напоминать в 18:50 08:00 15:45;
* stop - полное удаление данных о пользователе из базы;
* help - информационное сообщение о пользовании ботом.

### Пример использования бота
![Начало общения](https://sun9-68.userapi.com/impg/XTqmyQcIhwwWQvdbhNPDs9Jufkr37-MbpvEofQ/uw5w-BQsV8Q.jpg?size=514x441&quality=96&sign=5fb1cb559421c8907facfa3bd93263b3&type=album)
![Использование бота](https://sun9-42.userapi.com/impg/1pEs2N9qcWUipoTZTlJPllQHIUF5QEsxL73jVg/7we5nwtM9VI.jpg?size=513x451&quality=96&sign=bcb9dea0fc5400629096a15f0fc52265&type=album)
![Напоминание от бота](https://sun9-1.userapi.com/impg/6xPu7r9JYRZlVJ9SAAWTZznuOgaS6Mh5qyS9lA/g-D3LcnsoUI.jpg?size=537x65&quality=96&sign=8857a35eac252e1d1f3d71df5d26ebe3&type=album)

### Решенные задачи
Так как проект учебный, стоит рассказать о решенных задачах:
* Разбор сообщений пользователя на валидные команды и значения, а так же обратные сообщения при недопустимых командах.
* Хранение базы данных о пользователях.
* Создание многопоточного кода для возможности обработки нескольких соединений одновременно.
* Создание системы проверки необходимости напоминаний пользователям.
* Учет разности часовых поясов пользователя и бота, в частности, таких редких ситуаций, 
как сообщение от пользователя в 23:59:59 предыдущих суток, и дошедшая до бота информация в 00:00:01 следующих суток, и более общих случаев, которые могли приводить к неточностям во времени напоминания.
* Учет возникающих со стороны сервера Вконтакте TimeoutError раз в сутки примерно в 01:00 - 02:00 ночи по Москве.
* Введение системы журналирования для отлаживания багов и ошибок.

### Недостатки
Стоит сказать о недостатках кода, выявленных при решении задачи:
* Излишняя громоздкость обработки сообщений пользователя.
* Постпроверка сообщений пользователя вместо предпроверки валидности введенного сообщения, что влечет собой непредвиденные баги (например, возможность добавлять +- к введенным значениям, что может приводить к непредвиденным результатам).
* Топорная система базы данных, усложняющая хранение данных. С другой стороны, позволяющая безопасный доступ из нескольких потоков.
